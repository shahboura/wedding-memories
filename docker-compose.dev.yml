# ============================================================
# Development override — run with:
#   docker compose -f docker-compose.yml -f docker-compose.dev.yml up
# ============================================================
services:
  wedding-memories:
    build:
      context: .
      target: deps # Stop at deps stage — no production build
    command: pnpm dev
    environment:
      - NODE_ENV=development
      - EVENT_TOKEN=${EVENT_TOKEN:-}
      - RATE_LIMIT_UPLOAD_WINDOW_MS=${RATE_LIMIT_UPLOAD_WINDOW_MS:-300000}
      - RATE_LIMIT_UPLOAD_MAX=${RATE_LIMIT_UPLOAD_MAX:-60}
      - RATE_LIMIT_PHOTOS_WINDOW_MS=${RATE_LIMIT_PHOTOS_WINDOW_MS:-60000}
      - RATE_LIMIT_PHOTOS_MAX=${RATE_LIMIT_PHOTOS_MAX:-60}
    volumes:
      # Mount source code for hot-reload
      - .:/app
      # Preserve container's node_modules (don't overlay with host's)
      - /app/node_modules
      # Persist uploads
      - wedding-uploads:/app/uploads
